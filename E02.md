# 直立平衡控制

直立平衡控制问题，是两轮自平衡小车系统的首要问题。直立平衡控制的目标是使小车保持直立平衡状态，即使小车的俯仰角θ维持在期望值θ<sub>D</sub>附近。通常情况下，两轮自平衡小车机体质心位于两个轮子之上，期望俯仰角θ<sub>D</sub>=0，于是，采用PD控制算法：

u<sub>angle</sub>(t)=PD(θ)=k<sub>p</sub>\*θ(t)+k<sub>d</sub>\*(dθ(t))/dt

式中，k<sub>p</sub>为直立控制环节的比例系数，k<sub>d</sub>为直立控制环节的微分系数。
将上面式子用更通俗易懂的公式表达出来：

电机输出=k<sub>p</sub>\*角度+k<sub>d</sub>\*角速度

《The balance filter》中提到，在两轮自平衡小车中，PD控制的效果就跟添加可调节弹簧和阻尼器一样。如下图所示。

 
需要说明的是，在两轮自平衡小车的直立平衡控制环节中，选择PD控制而非PID控制的原因在于：

>   1. 两轮自平衡小车的姿态检测信号中不可避免地存在噪声信号，这些噪声信号经过积分I环节会随着时间不断地累积，从而导致积分器失去消除静差的调节功能并产生控制误差；

>   2. 两轮自平衡小车的轮胎与地面的摩擦会产生阻尼作用，这种阻尼可以克服小车姿态倾角静差的持续增加。


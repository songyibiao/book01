# STM32F1介绍和单片机最小系统

单片机相当于人或动物的大脑，接收并处理各传感器（包括陀螺仪和加速度传感器的信号），完成计算和规划后，向各执行机构（比如电机）发出控制命令。

在“小霸王Lite”项目中，单片机选择意法半导体的STM32F103C8T6，它体积小（LQFP48，7x7mm），功耗低（3.3V工作电压），运算速度快（10.25MIPS， ARM 32-bit Cortex™-M3 CPU），具有丰富的外设模块。

它的主要外设包括但不限于：

> + PWM： 8通道； 
> + AD转换器：10通道，12位； 
> + 定时器： 3通道16位通用定时器（TIM2/TIM3/TIM4），1通道高级控制定时器（TIM1）； 
> + 丰富的外部串行接口：SCI，I2C，SPI； 
> + IO口：最多可以提供 32 路，可以与5V器件直接相连。 
> + 内部存储器资源包括： 64k程序Flash， 20k数据RAM。

下图显示该单片机的内部资源情况。
 
经典的最小系统由单片机、供电电路、时钟电路、复位电路、启动配置电路和程序下载电路构成，该单片机的最小系统电路。

> + **供电电路**：STM32F103系列微控制器的工作电压为2.0V~3.6V。
> + **时钟电路**：时钟通常由晶体振荡器（简称晶振）产生，电路加入了两个时钟源，Y1是32.768KHz晶振，为RTC提供时钟；Y2是8MHz晶振，为整个系统提供时钟。
> + **复位电路**：采用按键和保护电阻电容构成复位电路，按下按键将触发系统复位。
> + **启动模式**：启动模式由BOOT0和BOOT1选择。在“小霸王Lite”设计方案中，BOOT1默认接低电平，BOOT1通过排针引出，通过跳帽可以配置不同的启动模式。
> + **下载调试**：预留SWD接口和USB接口。SWD是串行调试（Serial Wire Debug），与JTAG的20个引脚相比，SWD只需要4个引脚，结构更简单。另外，配备USB-TTL电路和Micro-USB接口，可以使用数据线，通过串口完成下载与调试。

“小霸王Lite”项目中，STM32F103C8T6单片机必须使用的的资源包括： 

> + I2C通讯接口：读取MPU-6050数据
>> + I2C1_SDA（PB8，PIN45）；
>> + I2C1_SCL（PB9，PIN46）； 
> + 电机转速脉冲接口 
>> + TIM2_CH1（PA0）和TIM2_CH2（PA1）：TIM2定时器增量编码器输入； 
>> + TIM4_CH1（PB6）和TIM4_CH2（PB7）：TIM4定时器增量编码器输入；
> + 电机PWM驱动接口 
>> + TIM3_CH1（PA6）和TIM3_CH2（PA7）：电机驱动；
> + 程序下载调试 SWD 接口 
>> + SWDIO（PIN34）； 
>> + SWCLK（PIN37）；  
> + 串口调试 UART 接口： 
>> + TXD（PIN6）； 
>> + RXD（PIN7）；
> + 蓝牙通讯 UART 接口： 
>> + TXD（PIN33）； 
>> + RXD（PIN34）；

除了上面其他确定使用的引脚，其它的没有占用的引脚全部预留出来，可以用作状态显示、辅助调试、扩展功能。

STM32最小单片机系统，实物图如下图所示。



如实物图所示， STM32F103C8T6单片机所有引脚通过排针方式预留出来。

> + STM32核心板有用户指示灯和电源指示灯各一个，其中用户指示灯可以通过编程修改用途。

> + STM32核心板有用户按键和复位按键各一个，其中用户按键可以通过编程修改用途。

> + STM32核心板预留有SWD接口，能使用仿真调试器（比如JLINK-OB、ST-Link等）进行下载和调试。

> + STM32核心板预留有USB-TTL电路和Micro-USB接口，只需要一根数据线，就能通过单片机内部的Bootloader程序，完成程序的开发和调试，无需使用额外的调试器。

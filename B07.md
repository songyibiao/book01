# 惯性测量单元和MPU-6050

## 惯性测量单元

两轮自平衡小车运动控制任务可以分解成以下三个基本控制任务：

> + 直立控制
> + 速度控制
> + 方向控制

其中，直立控制是关键。进行直立控制的前提是要获取准确的姿态数据，而获取姿态数据则要依靠惯性测量单元。

惯性测量单元，包括多种传感器，比如倾角仪、加速度传感器、陀螺仪、罗盘等传感器。表X给出了各惯性测量单元性能的对比分析。

 |测量值|优点|缺点
:--:|:--:|:--:|:--:
倾角仪|角度|静态性能好，精度高，无累积误差|动态响应速度慢
加速度传感器|加速度|静态性能好，精度高，更新频率快|存在累积漂移误差，动态响应慢
陀螺仪|角速度|动态响应好，频带宽，更新频率快|存在温漂和零漂
罗盘|角度|静态性能好，精度高，无漂移误差|动态响应速度慢，受环境磁场影响大

倾角仪测量与重力方向相关的姿态角，输出频率低，实时性较差，而且输出信号容易受噪声污染。对相频特性进行分析显示，倾角仪相位存在滞后。

加速度传感器测量与惯性有关的加速度，包括旋转、重力和线性加速度，对测量数据进行积分可以得到线性速度，二次积分可以得到线位移，但积分产生的漂移误差将随时间累积而无限制地增长导致积分后得到的数据不准确。加速度传感器通过三角函数运算可获得倾角值，但是输出信号容易受噪声污染。当加速度传感器垂直于俯仰角安装时，通过反正切函数运算可以作为倾角仪使用进行360°的全方位测量，并且不会产生线性化误差。

陀螺仪测量瞬时旋转角速度，由于温度变化、摩擦力、不稳定力矩等因素，会产生漂移误差。对陀螺仪测量数据进行积分可以得到与垂直方向相关的倾角信息，动态响应快，但漂移误差将随时间累积而无限增长。陀螺仪具有足够的带宽，动态性能好，静态输出受漂移误差影响较大。

罗盘通过测量相对于地磁场的方向，提供绝对姿态角信息。由于室内存在电源线和钢结构导致磁场产生畸变，罗盘一般不适于室内工作。

“小霸王Lite”设计方案采用加速度传感器与陀螺仪组合的惯性测量单元，对加速度值和陀螺仪值进行数据融合，测量精度高，能克服温度漂移和误差积分现象。

## MPU-6050

> 我一直强调，做电子设计要会看规格书，要以官网规格书为准。

> 通常，可以通过认真阅读规格书，了解一款芯片的功能和性能。

从InvenSense《MPU-6000-Register-Map》中可以摘取以下信息：

> The MPU devices provide the world’s first integrated 6-axis motion processor solution that eliminates the package-level gyroscope and accelerometer cross-axis misalignment associated with discrete solutions. The devices combine a 3-axis gyroscope and a 3-axis accelerometer on the same silicon die together with an onboard Digital Motion Processor™ (DMP™) capable of processing complex 9-axis sensor fusion algorithms using the field-proven and proprietary MotionFusion™ engine.

翻译成中文，大意就是：

> MPU芯片是全球第一个整合了六轴运动处理器的解决方案，相对于传统分立封装的多芯片方案，MPU芯片消除了组合陀螺仪与加速器交叉轴未对准的问题。MPU芯片内部集成了三轴陀螺仪和三轴加速度传感器，以及板载数字运动处理器™（DMP™），可以直接使用DMP™中经过验证的融合算法引擎（最多九轴）。

文字描述有时候远不如一张图、一张表格直观。通过内部框图，更能一目了然地了解MPU-6050的内部组成。

![](/img/2018-10-03_155833.png)

在MPU-6050的经典工作电路（Typical Operating Circuit）中，MPU-6050芯片的外围电路只需要几颗阻容器件，就能正常工作了，非常简洁。

![](/img/2018-10-03_155017.png)

参考、借鉴经典工作电路，设计出MPU-6050模块的电路。

将上述电路单独制作成小的电路板，可以比较方便放置在小车的最稳定的地方。实际的电路板下图所示。



# 使用 STM32CubeMX 配置工程

> 本节使用 STM32CubeMX 图形化配置软件和 Keil(MDK-ARM) 5.17 编译环境，演示如何配置 IO 引脚点亮 MiaowLabs-STM32F1-Micro 开发板上的 LED。

### 前期了解

我们使用的是 MiaowLabs-STM32F1-Micro 开发板，上面有一颗用户 LED。

![](/img/2019-02-20_224754.png)

这颗用户 LED 接的是 STM32F103C8T6 单片机的 PB12 引脚。PB12 引脚只要是设置为低电平，就可以点亮该 LED。

### 新建工程

开始配置。打开 STM32CubeMX 软件，点击「New Project」。

![](/img/2019-02-24_213944.png)

选择芯片。MiaowLabs-STM32F1-Micro 开发板上的芯片为 STM32F103C8T6。所以，要在 STM32CubeMX 选择使用该款芯片。有两种方法：

> * 第一种：搜索框大法。在 Part Number Search 搜索框中输入我们用到的芯片型号，本例中输入「STM32F103」。右边的 MCUs List 就会显示相关型号，能轻易地找到我们要用的 STM32F103C8T6。

![](/img/2019-02-24_214307.png)

> * 第二种：按图索骥法。在左边选择下拉列表慢慢筛选，直至筛选出想要的芯片。
>> * 根据 Core（内核）选择。如：ARM Cortex-M3...
>> * 根据 Series（系列）选择。如：F0、F1、F2...
>> * 根据 Line（产品线）选择。
>> * 根据 Package（封装）选择。
>> * 等等，不一一展开说明。

经过搜索或筛选，看到自己想要的芯片型号，双击选择芯片，本例选择 STM32F103C8T6。

工程配置。在上一步双击选择芯片后，就可进入了芯片工程配置界面。

点击菜单栏 Project ->Settings 弹出设置窗口。

![](/img/2019-02-24_220436.png)

在弹出的设置窗口有3个选项：

> * Project 工程设置：这个选项是主要设置的选项。
> * Code Generator 代码生成配置：这个选项是关于代码生成的配置。如：拷贝 HAL 库的配置、生成 .c 和 .h 的配置（一般不用修改，默认配置）。
> * AdvancedSettings 高级设置：这个选项在配置芯片（引脚功能）之后才能设置。

![](/img/2019-02-24_220754.png)

我们先对 Project 工程设置选项进行配置。如下图所示。

![](/img/2019-02-24_222008.png)

其中，工程名称为 Demo，工程目录放在 MiaowLabs-STM32F103-LED 文件夹（先在桌面新建该文件夹），IDE 工具选择 MDK-ARM V5，其他默认，点击 OK 即可。如果提示工程路径 d 盘不存在，那么修改路径中的 d 为 D 即可。

Pinout 配置。接下来的配置与最终运行代码密切相关。

放大芯片图标，找到 PB12。当使用芯片引脚过大，肉眼难找时，可以通过Find查找。

![](/img/2019-02-24_222807.png)

选中 PB12-> 左键 -> 弹出列表 -> 选中 GPIO_Output。

![](/img/2019-02-24_223018.png)

配置“晶振”引脚（RCC 配置）

如果使用“外部晶振”就还需要继续配置（我们配置HSE为例），包含三个配置：

HSE 外部高速时钟、LSE 外部低速时钟、MCO 时钟输出。

![](/img/2019-02-24_223250.png)

Clock配置

这里的配置是比较人性化的配置，结合时钟树，一看就明白（也可以根据参考手册时钟树配置），配置方法一样。

![](/img/2019-02-24_223402.png)

在 HCLK（MHz）中输入STM32F103C8最大工作频率 72Mhz，点击回车确定，其他的都会自动配置好。

“综合”配置

由于我们只配置了 PB12 引脚，其他功能（如 DMA、USB 等）没有配置，如果前面配置的有，这里配置的信息就比较多，所以叫「综合配置」。

点击 GPIO，弹出配置对话框，按步骤依次填写完信息，点击“OK”就好了：

![](/img/2019-02-24_223943.png)

![](/img/2019-02-24_224658.png)

低功耗配置

一般在学习阶段，低功耗配置比较少，在实际项目中配置低功耗需要考虑的东西比较多（包括硬件）。

生成代码

在完成上面所有配置之后，最后的工作就是点击“生成代码”按钮：

![](/img/2019-02-24_224948.png)

如果前面配置的生成软件工程，就会拷贝HAL库文件在你的工程：

![](/img/2019-02-24_225128.png)

最后提示打开软件工程（前提是你已经安装了 MDK-ARM）

![](/img/2019-02-24_225206.png)

至此，整个配置过程就完成了。

编译下载

打开工程，编译没有错误，没有警告，下载，程序运行；

![](/img/2019-02-24_225502.png)

把代码下载到则下载到开发板，重新复位就能见到 LED 点亮了。


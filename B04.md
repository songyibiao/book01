# 整体电路框架

设计电路存在一定的“套路”，同样适用于设计两轮自平衡小车的电路，用“首先-然后-最后”步骤法描述出来：

> 首先分析整个系统的输入、输出信号，然后选择合适的MCU（单片机），最后围绕MCU逐步设计出合适的子模块，形成完整的控制电路。

我们根据上述通用步骤，照葫芦画瓢，进行“小霸王Lite”两轮自平衡小车的电路设计。

首先，对两轮自平衡小车系统的输入输出信号进行分析，可以得到输入输出信号至少包括：

1. PWM接口（2路）
> 控制两个电机正反转。由于打算使用双极性PWM驱动，这里预计只需要用到2路PWM。如果采用单极性PWM驱动，则需要用到4路PWM。

2. 定时器接口（2路）
> 捕捉编码器脉冲。定时器有正交编码器模式最好。因为两个编码器，这里预计需要两个定时器脉冲输入端口。
 
3. ADC接口（1路）
> 用于电池电压检测，至少1路。

4. 通讯接口（UART 2路、I2C 1路） 
> + UART：2路，分别用于下载调试接口、与蓝牙模块通信。
> + I2C：如果选择数字传感器，可以通过I2C接口读取加速度与陀螺仪数据。

5. GPIO口（4路） 
> 用作电机变向驱动。至少预留4路。其它GPIO口，可应用在运行状态显示，功能扩展等地方上。 

通过简单的分析，我们就可以知道要选用至少包含哪些功能的单片机——在外设方面，至少包含2路PWM接口、2个定时器接口、1路ADC接口、2路UART接口、1路I2C接口、4路GPIO接口。

然后，我们直接“按图索骥”，可以在市场上找到很多合适的单片机。但是，小霸王Lite项目最终选择使用意法半导体的单片机STM32F103C8T6。一是因为STM32的性能、功能都能满足两轮自平衡小车的设计要求；二是因为STM32的出货量大，教程文档、开发板都多如牛毛，生态系统非常丰富。

最后，围绕着单片机进行设计其它的功能子模块，整体电路框架自然而然就出来了。

![](/img/2018-09-02_105402.png)
 
在整体电路框图中，除了单片机最小系统，还有以下必需的子模块： 

> + 下载调试电路：这部分电路简单，可以与单片机最小系统设计成一块电路板，方便调试；
> + 惯性测量单元：加速度传感器、陀螺仪，这里选择使用六轴传感器MPU-6050；
> + 电机驱动电路：驱动两个电机运行的功率电路，这里选择使用驱动芯片TB6612FNG；
> + 电源稳压电路：电压转换、稳压、滤波电路；

另外，我们还考虑到DIYer心中期待的两个高频需求：

> + 各模块是否模块化设计。项目完成后DIYer对模块进行重复使用。
> + 单片机引脚是否全部引出来。DIYer要天马行空，再次二次开发。

基于这两个高频需求，在小霸王Lite的电路设计中，使用了“模块+底板”的拼接方式，利用排针排母等接插件，将各模块与底板进行电气连接。

# STM32基础外设-GPIO

GPIO 是学习嵌入式、学习单片机、学习 STM32 的第一个知识点。

GPIO 全称为 General-Purpose Inputs/Outputs，中文翻译为「通用输入/输出端口」，是 STM32 用于输出信号，输入信号的通道。

根据数据手册中列出的每个 I/O 端口的特定硬件特征，  GPIO 端口的每个引脚可以由软件分别配置成多种模式。

输入模式：

* 浮空输入 GPIO_Mode_IN_FLOATING
* 上拉输入 GPIO_Mode_IPU
* 下拉输入 GPIO_Mode_IPD
* 模拟输入 GPIO_Mode_AIN

输出模式：

* 开漏输出 GPIO_Mode_AF_OD
* 推挽输出 GPIO_Mode_Out_PP 
* 复用开漏输出 GPIO_Mode_AF_OD
* 复用推挽输出 GPIO_Mode_AF_PP 

接下来，我将分别介绍每个模式的原理以及用途。首先，要祭出「I/O端口引脚的基本结构」图，我们要对着结构图进行剖析。

![](/img/2019-04-26_223150.png)

我们从上图能看到两条虚线分别框住的两个部分，即输入驱动器和输出驱动器。输入驱动器的主要元件是 TTL 施密特(肖特基)触发器。这个触发器的主要作用是：设定电压阈值，超过/低于该电压，才可通过。输出驱动器的主要元件是 P-MOS 管和一个 N-MOS 管。

这里插入补充一下 MOS 管的相关知识，因为这对于我们后面理解结构图会有很大的帮助。

MOS 管是由加在输入端栅极的电压(GU)来控制输出端漏极的电流（DI）的元器件。它类似于三极管，有三个极，分别为栅极/门极（G）,源极（Source）和漏极（Drain）。按沟道半导体材料的不同，结型和绝缘栅型各分「N 沟道」和「P 沟道」两种。若按导电方式来划分，场效应管又可分为「耗尽型」与「加强型」。结型场效应管均为耗尽型，绝缘栅型场效应管既有耗尽型的，也有加强型的。如下图：

![](/img/2019-04-26_225037.png)

我们可以从上图看到 N-MOS 管的箭头指向绝缘板。MOS 管有一个重要的参数就是开启电压。对于 N-MOS 管来说，这里我们要想让源极 S 和漏极 D 之间开始通电，则栅极和源级之间的电压必须大于开启电压。同理，对于 P-MOS 管，栅极和源级电压必须小于开启电压。比如说，这里我们开启电压是 5v，源级电压是 12v，栅极电压要12 + 5 = 17v 才能导通。

导通特性：

* N-MOS 的特性，Vgs 大于一定的值就会导通，适合用于漏极 D 接电源，源极 S 接地时的情况（低端驱动），只要栅极电压达到 4v 或 10v 就可以了。需要注意的是，Vgs 指的是栅极 G 与源极 S 的电压。
* P-MOS 的特性，Vgs 小于一定的值就会导通，适合用于源极接 VCC 时的情况（高端驱动）。但是，虽然 P-MOS 可以很方便地用作高端驱动，但由于导通电阻大，价格贵，替换种类少等原因，在高端驱动(大功率)中，通常还是使用 N-MOS。

### 模式详解

作为新手，初次接触到一堆新名词，例如「浮空输入 GPIO_Mode_IN_FLOATING」、「上拉输入 GPIO_Mode_IPU」，了解新名词不等于掌握知识点，还需要深入探究。

###### 浮空输入 GPIO_Mode_IN_FLOATING

![](/img/2019-04-27_121111.png)

浮空输入的路线为红色标注部分，外部的电平信号通过右边编号 1 的 I/O 引脚进入 STM32，经过编号 2 的施密特触发器的整形，再送入编号 3 的输入数据寄存器储存，在输入数据寄存器的另一端(编号 4)，CPU 可以随时读出 I/O 引脚的电平状态。整条输入路线既没有内部上拉电路，也没有内部下拉电路，所以称之为「浮空输入」。

